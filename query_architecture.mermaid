graph TD
    User[User / Client]
    
    subgraph "Edith Query Engine"
        API[FastAPI]
        Cal[Calendar Service]
        RAG[RAG System]
        DB[(ChromaDB)]
    end
    
    subgraph "External Services"
        G_CAL[Google Calendar API]
        LLM[Google Gemini]
    end

    User -- "Ask Question" --> API
    
    %% Context Gathering
    API -- "Fetch Schedule" --> Cal
    Cal -- "List Events" --> G_CAL
    G_CAL -- "Events Data" --> Cal
    Cal -- "Calendar Context" --> API
    
    %% RAG Flow
    API -- "Query + Context" --> RAG
    RAG -- "Vector Search" --> DB
    DB -- "Relevant Docs" --> RAG
    
    %% Generation
    RAG -- "Prompt Construction" --> LLM
    LLM -- "Natural Language Answer" --> RAG
    RAG -- "Response" --> API
    API --> User